<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- this is the code that will allow icon to be visible in the title bar of the brower -->
<link rel="icon" type="image/ico" href="../Logo.png" />
<title>DHS JS Tutorial</title>
<!-- you can also say this:  <link rel="icon" type="image/png" href="location/image.png" /> -->
<h1 class="center-text"><span
        style="background-color: rgb(255, 251, 0); padding-left: 5px; padding-right: 5px;">JavaScript Tutorial</span>
</h1>
<div id="lessonKey"></div>
<input type="text" id="keyEnter" value="" placeholder="Lesson Key" maxlength="100" />
<button id="jump" style="display: inline;">Jump</button>
<div id="lesson"></div>
<div class="row">
    <div class="column">
        <textarea id="code" style="width: 90%;" spellcheck="false"></textarea>
    </div>
    <div class="column">
        <div><button id="run" style="width: 90%;">Run Code</button></div>
        <h2 style="padding-bottom: 0px;">Code Output Console</h2>
        <div id="grade"><p>Output from your code will show up in this console below.</p></div>
        <textarea id="ConsoleOutput" style="width: 90%; height: 200px;" disabled=true></textarea>
    </div>
</div>
<link rel="stylesheet" href="../StyleSheet.css">
<!--Import the lessons function from lessons.js file-->
<script src="./lesson.js"></script>
<script src="./Constants.js"></script>
<script src="./CookieCode.js"></script>
<body onload="checkCookie()"></body> /**/
<script>
    refreshLessonPage();
    let consoleLogs = [];
    var displayConsole = document.getElementById("ConsoleOutput");
    var inputCode = document.getElementById("code");
    //Redefine console.log function
    console.log = function (arg) {
        consoleLogs.push(arg);
    }
    let runner = document.getElementById("run");
    runner.addEventListener("click", () => {
        let codeValue = inputCode.value;
        evalAndReturn(codeValue);
        //console.log(codeValue); // <- This line is only for debugging; it breaks the code.
    });
    let jumper = document.getElementById("jump");
    function checkKey() {
        for (let i = 0; i < lessonSkipCodes.length; i++) {
            if (lessonSkipCodes[i] == document.getElementById("keyEnter").value) {
                //The key matches the lesson, so jump to that lesson
                lessonNumber = i;
                refreshLessonPage();
                setCookie("lesson", lessonNumber, 365);
            }
        }
    }
    document.getElementById('code').addEventListener('keydown', function (e) {
        if (e.key == 'Tab') {
            e.preventDefault();
            var start = this.selectionStart;
            var end = this.selectionEnd;

            // set textarea value to: text before caret + tab + text after caret
            this.value = this.value.substring(0, start) +
                "\t" + this.value.substring(end);

            // put caret at right position again
            this.selectionStart =
                this.selectionEnd = start + 1;
        }
    });
    jumper.addEventListener("click", () => {
        checkKey();
    });
    function evalAndReturn(code) {
        displayConsole.value = "";
        let newItem = eval(code);
        for (let i = 0; i < consoleLogs.length; i++) {
            displayConsole.value += consoleLogs[i] + "\n";
        }
        checkWithAnswer(consoleLogs, code);
        consoleLogs = [];
    }
    function nextLesson() {
        let Grade = document.getElementById("grade");
        Grade.innerHTML = `<p>Output from your code will show up in this console below.</p>`;
        lessonNumber++;
        refreshLessonPage();
        //Automatically go to the top of the page
        window.location = "#";
        //Automatically clear the output console and input textarea
        displayConsole.value = "";
        inputCode.value = "";
        //update the cookie with the lesson number
        setCookie("lesson", lessonNumber, 365);
    }
    function checkWithAnswer(codeOutput, rawCode) {
        let Grade = document.getElementById("grade");
        let allOutputsGood = true;
        for (let i = 0; i < desiredOutputs.length; i++) {
            if (desiredOutputs[lessonNumber][i] != codeOutput[i]) {
                allOutputsGood = false;
            }
        }
        if (allOutputsGood == true) {
            //We have the desired output. Now, lets see if we have all of our desired keywords in the code.
            let allKeyWords = true;
            for (let i = 0; i < requiredKeywords[lessonNumber].length; i++) {
                if (rawCode.indexOf(requiredKeywords[lessonNumber][i]) == -1) {
                    //we are missing the keyword
                    allKeyWords = false;
                    displayConsole.value += "\nLESSON FEEDBACK: \nmissing keyword " + requiredKeywords[lessonNumber][i];
                } else {
                }
            }
            if (allKeyWords == true) {
                //We passed!
                Grade.innerHTML = `<p>Congratulations, your code built successfully and had the corret output!<img src="../Checkmark.png" height=15><button onclick="nextLesson();">Next Lesson</button></p>`;
            } else {
                Grade.innerHTML = `<p>The console output is correct, but you have not coded it properly. Please edit your code, making sure that you have followed all instructions, and try again. Taking "shortcuts" are not allowed for passing the lesson.</p>
                <p style="color: red">Incorrect<img src="../Fail.png" height=15></p>`;
            }
        } else {
            Grade.innerHTML = `<p>The console output is not correct.\nPlease edit your code and try again.</p> 
            <p style="color: red">Incorrect<img src="../Fail.png" height=15></p>`;
        }
    }
</script>

</html>